id: test-javascript-ssh
info:
  name: test-javascript-ssh
  author: Ice3man
  severity: high
  metadata:
    shodan-query: "kerberos"

javascript:
  # See if we can discover the DC name from other
  # services running on the same host. Maybe netbios
  # or other Windows Or DNS name related services.

  # TODO: Add more types for domain retrieval. Use a shared helper
  # function.
  #
  # Also in future, only do requests if the port specified has been
  # discovered on the target.
  - pre-condition: >
      if (Domain == "") {
        var s = require("nuclei/smb");
        var sc = s.Client();
        var list = sc.ListSMBv2Metadata(Host, 445);
        if (list && list.DNSDomainName != "") {
          dump_json(list);
          console.log("Got domain controller", list.DNSDomainName);
          Domain = list.DNSDomainName;
        } else {
          console.log("No dc found, try other methods");
        }
      }
    pre-condition-exports:
      - Domain
    code: >
      var m = require("nuclei/kerberos");
      var c = m.Client();
      c.EnumerateUser(Domain, Host, User);
    args:
      Host: "{{Host}}"
      User: "{{usernames}}"
      Domain: "{{Domain}}"
    output: true
    payloads:
      usernames:
        - 'backup'
        - 'admin'
        - 'user'
        - 'root'
        - 'administrator'
        - 'webadmin'
        - 'sysadmin'
        - 'netadmin'
        - 'guest'
        - 'web'
        - 'test'
        - 'svc-admin'
        - 'Administrator'
  
    matchers:
      - type: word
        part: response
        words:
          - "true"