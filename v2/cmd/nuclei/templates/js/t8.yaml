id: test-javascript-ssh
info:
  name: test-javascript-ssh
  author: Ice3man
  severity: high
  metadata:
    shodan-query: "kerberos"

javascript:
  # Also in future, only do requests if the port specified has been
  # discovered on the target.
  - pre-condition: >
      Domain = getDomainControllerName(Domain, Host);
    pre-condition-exports:
      - Domain
    code: >
      var m = require("nuclei/kerberos");
      var c = m.Client();
      c.EnumerateUser(Domain, Host, User);
    args:
      Host: "{{Host}}"
      User: "{{usernames}}"
      Domain: "{{Domain}}"
    output: true
    payloads:
      usernames:
        - 'backup'
        - 'admin'
        - 'user'
        - 'root'
        - 'administrator'
        #- 'webadmin'
        #- 'sysadmin'
        #- 'netadmin'
        #- 'guest'
        #- 'web'
        #- 'test'
        #- 'svc-admin'
        #- 'Administrator'
  
    matchers:
      - type: word
        part: response
        words:
          - "true"